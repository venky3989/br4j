<!--

      Licensed to the Apache Software Foundation (ASF) under one or more
      contributor license agreements.  See the NOTICE file distributed with
      this work for additional information regarding copyright ownership.
      The ASF licenses this file to you under the Apache License, Version 2.0
      (the "License"); you may not use this file except in compliance with
      the License.  You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.

-->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>БДМИ/СУСС - Теги</title>
<style type="text/css">
dt { font-weight: bold; margin-top: 15px; }
</style>
</head>
<body>
<h1>Теги</h1>

<p><a href="portlets.html">Портлеты</a>
<a href="templates.html">Шаблоны</a>
Теги
</p>

<hr>
<a name="content"></a>
<h2>Content</h2>

<p>Это основной тег, используемый для вставки в текст элементов, связанных с содержимым карточек системы.
Смысл тега практически полностью определяется атрибутом <i>type</i>, поэтому в дальнейшем описание тега
<i>content</i> сгруппировано по значению этого атрибута.</p>
<p>Тем не менее, имеется несколько общих атрибутов, применимых ко всем или к нескольким различным типам
тега <i>content</i>, и они описаны ниже. Кроме того, если тег управления содержимым раскрывается
в единственный тег HTML, атрибуты, неизвестные системе управления содержимым сайта, переписываются
в атрибуты выводимого тега HTML. Таким образом возможно указывать HTML-атрибуты типа <i>class</i>,
<i>style</i> и т.&nbsp;д.</p>

<h3>Атрибуты</h3>
<dt>type</dt>
<dd>Основной атрибут тега. Определяет семантику тега, набор и интерпретацию большинства других атрибутов
тега. Значение по умолчанию &mdash; <a href="#text">text</a>, если указан атрибут <i>field</i>, и
<a href="#file">file</a> в ином случае.</dd>
<dt>field</dt>
<dd>Задаёт имя поля, содержимое которого отображается в документе. В качестве имени поля может
использоваться русское или английское название характеристики карточки, либо её внутренний идентификатор.
Имени характеристики может предшествовать имя блока характеристик, отделённое двоеточием.
Если характеристика с заданным именем отсутствует в карточке, содержимое не отображается. Если атрибут
<i>field</i> не задан, для отображения используется материал, присоединённый к карточке.<br>
Карточка, из которой извлекается содержимое, задаётся атрибутом <i>id</i>, либо парой атрибутов
<i>link/item</i>. Если не указано ни то, ни другое, используется текущая карточка, каковой для тегов
верхнего уровня является карточка текущего документа, а для вложенных &mdash; карточка, выбранная
для объемлющего тега.</dd>
<dt>id</dt>
<dd>Идентификатор карточки, используемой для отображения содержимого (число). Если карточка не найдена,
содержимое не отображается.<br>
В этом атрибуте могут использоваться вложенные теги управления содержимым, однако результирующий текст
должен являться числом &mdash; допустимым идентификатором карточки. Наиболее типичный случай использования
вложенных тегов: <code>&lt;content type="<a href="#var">var</a>" ...&gt;</code>.</dd>
<dt>link</dt>
<dd>Имя поля, содержащего ссылки на карточки. Используется совместно с атрибутом <i>item</i> для задания
карточки, которая будет использоваться при отображении содержимого. Если поле отсутствует в карточке или не
содержит ссылок, содержимое не отображается. Правила задания имени поля см. в атрибуте <i>field</i>.</dd>
<dt>item</dt>
<dd>Строка, позволяющая выбрать одну карточку из списка ссылок, заданного атрибутом <i>link</i>.
Допускаются два варианта задания строки:
<ul>
<li><i>имя поля=значение</i> В этом случае производится выбор карточки, содержащей заданное значение в
указанном поле. Правила задания имени поля см. в атрибуте <i>field</i>.
<li><i>значение</i> Выбирается карточка, содержащая заданное значение в любом поле.
</ul>
В обоих случаях учитываются не все поля связанных карточек, а только те, которые отображаются в списке
в головной карточке.<br>
Если карточка, удовлетворяющая условию, не найдена, содержимое не отображается. Если при наличии атрибута
<i>link</i> отсутствует атрибут <i>item</i>, то используется первая карточка из списка ссылок. Это удобно,
когда список ссылок содержит единственную ссылку.</dd>
<dt>start</dt>
<dd>HTML, отображаемый перед содержимым тега в случае, если оно не пустое. Может содержать также теги
управления содержимым.</dd>
<dt>end</dt>
<dd>HTML, отображаемый после содержимого тега в случае, если оно не пустое. Может содержать также теги
управления содержимым.</dd>
<dt>empty</dt>
<dd>HTML, отображаемый в случае, если содержимое тега пусто.
<dt>error</dt>
<dd>HTML, отображаемый в случае ошибки при формировании содержимого. Может содержать также теги
управления содержимым, однако, следует быть осторожным, так как они тоже могут не отображаться из-за
ошибок.</dd>

<hr>
<a name="count"></a>
<h2>Content type=count</h2>

<p>Отображает количество элементов в списке карточек.</p>

<h3>Дополнительные атрибуты</h3>
<p>См. атрибуты формирования списка в теге типа <a href="#list">list</a>.</p>

<hr>
<a name="file"></a>
<h2>Content type=file</h2>

<p>Отображает содержимое поля карточки в виде гиперссылки на скачивание материала, прикрепленного
к этой карточке. Если прикрепленный документ отсутствует, ссылка не отображается. Если в теге не задан
атрибут <i>field</i>, то в качестве текста ссылки используется имя прикрепленного файла.</p>

<h3>Дополнительные атрибуты</h3>
<p>Любые атрибуты, допустимые в HTML-теге <i>a</i>, кроме <i>href</i>.</p>

<hr>
<a name="html"></a>
<h2>Content type=html</h2>

<p>Отображает содержимое материала или поля карточки как HTML-текст. В выводимом тексте производится
обработка тегов управления содержимым сайта.</p>

<h3>Дополнительные атрибуты</h3>
<p><i>Отсутствуют.</i></p>

<hr>
<a name="ident"></a>
<h2>Content type=ident</h2>

<p>Отображает содержимое тега несколько раз. Количество повторов определяется значением характеристики,
указанной в атрибуте <i>field</i>. Характеристика должна иметь числовой тип.</p>
<p>При использовании в карточке "<a href="templates.html#Navigator">Навигация по сайту</a>" атрибут
<i>field</i> может не указываться. В таком случае будет использоваться значение уровня вложенности
элемента, вычисляемое навигатором.</p>

<h3>Дополнительные атрибуты</h3>
<p><i>Отсутствуют.</i></p>

<hr>
<a name="image"></a>
<h2>Content type=image</h2>

<p>Отображает содержимое материала как изображение, включенное в текст. Атрибут <i>field</i>
для этого типа тега игнорируется.</p>

<h3>Дополнительные атрибуты</h3>
<p>Любые атрибуты, допустимые в HTML-теге <i>img</i>, кроме <i>src</i>.</p>

<hr>
<a name="link"></a>
<h2>Content type=link</h2>

<p>Отображает содержимое материала или поля карточки как текст, оформленный в виде гиперссылки
на отображение этой карточки в текущем разделе сайта. Если карточка является карточкой раздела сайта,
то ссылка будет вести на заданный раздел сайта.</p>

<h3>Дополнительные атрибуты</h3>
<p>Любые атрибуты, допустимые в HTML-теге <i>a</i>, кроме <i>href</i>.</p>
<p>См. также атрибуты, определенные в теге типа <a href="#url">url</a>.</p>

<hr>
<a name="list"></a>
<h2>Content type=list</h2>

<p>Отображает список карточек материалов с помощью вспомогательной карточки по шаблону
"<a href="templates.html#List">Список материалов</a>".</p>
<p>Список может формироваться различными способами: список связанных карточек, список материалов,
опубликованных в разделе сайта, поисковый запрос, сформированный пользователем или определенный
в системе. Способом формирования списка управляют специальные атрибуты, которые описаны ниже и вынесены
в отдельную категорию, так как используются и в других типах тега <i>content</i>.</p>
<p>Список может быть разбит на страницы с заданным количеством элементов; в таком случае при отображении
учитывается выбранная пользователем страница. Также имеется специальный тип тега
<a href="#pages">content type=pages</a>, позволяющий отображать навигацию по страницам списка.</p>
<p>При обработке тега определяется ряд переменных, которые доступны в тегах управления содержимым
внутри характеристик карточки отображения. Их список с описанием приведен ниже.</p>

<h3>Атрибуты формирования списка</h3>
<dt>list</dt>
<dd>Указывает способ получения списка материалов. Допустимые значения:<ul>
<li><b>links</b> &mdash; используется список карточек из поля, заданного атрибутом <i>links</i>.</li>
<li><b>area</b> &mdash; отображается список карточек, опубликованных в области сайта, заданной
атрибутом <i>area</i>. Если атрибут отсутствует, используется текущая область сайта.</li>
<li><b>xml</b> &mdash; отображается список карточек, найденных по поисковому запросу, заданному
в атрибуте <i>xml</i>.</li>
<li><b>search</b> &mdash; используется список карточек, найденных по поисковому запросу,
сформированному портлетом поиска, входящим в систему БДМИ.</li>
</ul>
Если атрибут <i>list</i> не задан, то способ задания списка определяется по наличию атрибута
<i>links</i>, <i>area</i> или <i>xml</i>.</dd>
<dt>links</dt>
<dd>Имя характеристики карточки, используемой для получения списка карточек. Правила задания имени
такие же, как у общего атрибута <i>field</i>. Характеристика должна иметь тип CardLink или BackLink.
<br>Этот атрибут обязателен при указании <i>list=links</i> и не может применяться одновременно с
атрибутами <i>area</i> или <i>xml</i>.
<br><i>Дополнение Босс-Референт.</i> Характеристика также может иметь тип Person. В таком случае
список формируется из карточек выбранных в характеристике пользователей.</dd>
<dt>area</dt>
<dd>Число &mdash; идентификатор области сайта, используемой для получения списка документов.
Может содержать теги управления содержимым, формирующие этот идентификатор.
<br>Этот атрибут не может применяться одновременно с <i>links</i> или <i>xml</i>.</dd>
<dt>xml</dt>
<dd>XML поиска, используемого для формирования списка материалов. Атрибут может содержать теги
управления содержимым, как для заполнения отдельных тегов или атрибутов внутри XML, так и
для формирования XML целиком, например, чтения его из специальной характеристики карточки.
<br>Этот атрибут обязателен при указании <i>list=xml</i> и не может применяться одновременно с
атрибутами <i>links</i> или <i>area</i>.</dd>
<dt>filter</dt>
<dd><i>Дополнение Босс-Референт.</i> XML поиска, используемого для фильтрации элементов списка.
Фильтрация должна осуществляться только по характеристикам, и в ней не может использоваться элемент
<i>words</i> (поиск по текстовым характеристикам). Обработка тегов управления содержимым
производится так же, как и для атрибута <i>xml</i>.
<br>Атрибут может использоваться только совместно с атрибутм <i>links</i>.</dd>

<h3>Дополнительные атрибуты</h3>
<dt>view</dt>
<dd><b>Обязательный.</b> Идентификатор карточки, используемой для отображения списка.</dd>
<dt>fetch</dt>
<dd>Способ обработки элементов списка. Допустимые значения:<ul>
<li><b>true</b> &mdash; перед отображением элемента списка производится запрос полной карточки
из системы. Это существенно снижает скорость отклика, но может быть необходимо для правильного
отображения карточек в сложных списках.</li>
<li><b>false</b> &mdash; для отображения списка используются сокращенные версии карточек,
полученные при выполнении поиска. Использование этого варианта предпочтительно, если есть
возможность указать в запросе поиска все необходимые для отображения в списке поля карточек.</li>
</ul>Значение по умолчанию &mdash; false.</dd>

<h3>Определяемые переменные</h3>
<dt>count</dt>
<dd>Число &mdash; количество элементов в списке.</dd>
<dt>index</dt>
<dd>Число &mdash; порядковый номер текущего элемента в списке.</dd>
<dt>item</dt>
<dd>Идентификатор карточки &mdash; текущего элемента в списке.</dd>
<dt>prev</dt>
<dd>Идентификатор карточки &mdash; предыдущего элемента в списке.</dd>
<dt>next</dt>
<dd>Идентификатор карточки &mdash; следующего элемента в списке.</dd>
<dt>first</dt>
<dd>Идентификатор карточки &mdash; первого элемента в списке.</dd>
<dt>last</dt>
<dd>Идентификатор карточки &mdash; последнего элемента в списке.</dd>
<dt>pages</dt>
<dd>Число &mdash; количество страниц, на которые разбит список.</dd>
<dt>page</dt>
<dd>Число &mdash; порядковый номер отображаемой страницы списка.</dd>
<dt>page.size</dt>
<dd>Число &mdash; количество элементов на странице списка.</dd>
<dt>page.first</dt>
<dd>Число &mdash; порядковый номер первой страницы списка (1).</dd>
<dt>page.last</dt>
<dd>Число &mdash; порядковый номер последней страницы списка. Равно общему количеству страниц.</dd>

<hr>
<a name="modify"></a>
<h2>Content type=modify</h2>

<p>Используется для интерактивного изменения карточки пользователем сайта, либо создания новой.
Позволяет изменить значения любых характеристик, входящих в карточку, а также изменить её статус.
Изменяемая карточка определяется, как обычно, атрибутом <i>id</i> либо парой атрибутов
<i>link</i>/<i>item</i>. Для создания карточки применяется специальный атрибут <i>create</i>.</p>
<p>Все действия выполняются от имени текущего пользователя системы и проходят необходимые проверки,
т.е. пользователь не сможет изменить те характеристики, на редактирование которых не имеет прав;
то же касается изменения статуса. В случае возникновения любой ошибки все произведённые действия
отменяются, а текст ошибки становится доступен через переменную <i>error</i>.</p>
<p>Данный тип тега раскрывается в HTML-тег <code>form</code>. Для правильной работы тега внутри него
должен содержаться некоторый элемент управления HTML, осуществляющий посылку данных формы, например:
<code>&lt;input type="submit" ...&gt;</code>. Кроме того, здесь могут применяться специальные теги
управления содержимым, позволяющие изменять значения характеристик карточки, например,
<a href="#edit">edit</a>, <a href="#set>set</a> и др. Также внутри тега может содержаться обычный
HTML код и иные теги управления содержимым.</p>
<p>Обработка данных формы производится системой управления содержимым сайта. Изменяемая карточка
блокируется для изменения другими пользователями на период сохранения изменений и смены статуса &mdash;
после отправки пользователем заполненной формы. Это отличается от логики стандартного портлета
редактирования карточки, который блокирует карточку в момент открытия её на редактирование.
Будьте осторожны: при совместном изменении одной и той же карточки один пользователь может переписать
изменения, внесённые другим, даже не узнав об этом.</p>

<h3>Дополнительные атрибуты</h3>
<dt>create</dt>
<dd>Русское или английское название либо числовой идентификатор шаблона, по которому должна быть
создана новая карточка. При наличии этого атрибута в теге атрибуты <i>id</i>, <i>link</i> и <i>item</i>
игнорируются.</dd>
<dt>proceed</dt>
<dd>Русское или английское название либо числовой идентификатор статуса, в который должна быть
переведена карточка, или же русское или английское название либо числовой идентификатор операции
перевода в этот статус (то, что написано на соответствующей кнопке в портлете редактирования карточки).
<br>В случае отсутствия этого атрибута изменение статуса не производится.</dd>
<dt>success</dt>
<dd>URL страницы, которая будет отображена после успешного сохранения карточки и изменения её статуса.
<br>В случае отсутствия этого атрибута перенаправление не производится.</dd>
<dt>failure</dt>
<dd>URL страницы, которая будет отображена в случае возникновения любой ошибки при обработке данных
формы. Текст ошибки доступен через переменную <i>error</i>.
<br>В случае отсутствия этого атрибута перенаправление не производится.</dd>
<dt>htmlid</dt>
<dd>HTML идентификатор формы. Может быть использован для работы с формой через javascript.</dd>
<p>Любые атрибуты, допустимые в HTML-теге <i>form</i>, кроме <i>action</i> и <i>method</i>.</p>

<hr>
<a name="page"></a>
<h2>Content type=page</h2>

<p>Может применяться только внутри характеристик карточки, созданной по шаблону 
"<a href="templates.html#Pager">Навигация по страницам</a>", отвечающих за отображение одной страницы.
Отображает ссылку на заданную страницу списка. Текст ссылки задаётся содержимым тега, а если оно
отсутствует, то используется номер страницы.</p>

<h3>Дополнительные атрибуты</h3>
<dt>page</dt>
<dd><b>Обязательный.</b> Номер страницы списка, на который должна указывать ссылка. В этом атрибуте
могут использоваться теги управления содержимым сайта, например:
<code>&lt;content type="<a href="#var">var</a>" ...&gt;</code>.</dd>

<hr>
<a name="pages"></a>
<h2>Content type=pages</h2>

<p>Отображает навигацию по страницам списка с помощью специальной карточки, созданной по шаблону
"<a href="templates.html#Pager">Навигация по страницам</a>". Идентификатор этой карточки должен быть
указан в атрибуте <i>id</i> тега.</p>
<p>При обработке тега определяется ряд переменных, которые доступны в тегах управления содержимым
внутри характеристик карточки навигации. Их список с описанием приведен ниже.</p>

<h3>Дополнительные атрибуты</h3>
<p><i>Отсутствуют.</i></p>

<h3>Определяемые переменные</h3>
<dt>prev</dt>
<dd>Порядковый номер предыдущей страницы.</dd>
<dt>next</dt>
<dd>Порядковый номер следующей страницы.</dd>
<dt>itemFirst</dt>
<dd>Порядковый номер первого элемента списка, отображаемого на текущей странице.</dd>
<dt>itemLast</dt>
<dd>Порядковый номер последнего элемента списка, отображаемого на текущей странице.</dd>

<hr>
<a name="text"></a>
<h2>Content type=text</h2>

<p>Отображает содержимое материала или поля карточки как простой текст.</p>

<h3>Дополнительные атрибуты</h3>
<dt>limit</dt>
<dd>Число. Ограничивает вывод тега указанным количеством символов. Если содержимое характеристики или
материала длиннее, то лишние символы заменяются содержимым атрибута <i>ellipsis</i>.</dd>
<dt>ellipsis</dt>
<dd>Используется только совместно с атрибутом <i>limit</i>. Задает HTML-текст, выводимый в случае
превышения значением характеристики ограничения количества символов. Может содержать другие теги
управления содержимым. Значение по умолчанию: "<code>...</code>".</dd>

<hr>
<a name="url"></a>
<h2>Content type=url</h2>

<p>Раскрывается в ссылку на страницу портала, отображающую либо заданный документ в текущем разделе
сайта, либо, если карточка создана по шаблону "<a href="templates.html#SiteArea">Раздел сайта</a>",
указанный раздел сайта.</p>
<p>Данный тип тега предназначен, в основном, для использования в невизуальных элементах HTML,
например, в атрибуте <i>href</i> HTML-тега <i>a</i>:
<code>&lt;a href='&lt;content type="url" .../&gt;'&gt;Ссылка&lt;/a&gt;</code>.</p>

<h3>Дополнительные атрибуты</h3>
<dt>page</dt>
<dd>Путь к станице портала, используемой для отображения документа или раздела сайта. Путь указывается
относительно контекста портала, т.&nbsp;е. <code>/portal/auth/portal</code> указывать не надо.
<br>Если этот атрибут не указан, используется страница портала, заданная в карточке того раздела сайта,
который будет отображен при переходе по ссылке (см. шаблон
"<a href="templates.html#SiteArea">Раздел сайта</a>").
</dd>

<hr>
<a name="var"></a>
<h2>Content type=var</h2>

<p>Отображает содержимое внутренней переменной, определённой в системе. Ряд переменных определяется
самой системой, они описаны ниже. Некоторые теги могут определять дополнительные переменные,
которые, как правило, видны внутри этих тегов (в атрибутах и содержимом).</p> 

<h3>Дополнительные атрибуты</h3>
<dt>var</dt>
<dd><b>Обязательный.</b> Имя переменной.</dd>

<h3>Системные переменные</h3>
<dt>area</dt>
<dd>Идентификатор карточки текущего раздела сайта.</dd>
<dt>document</dt>
<dd>Идентификатор карточки текущего документа.</dd>
<dt>error</dt>
<dd>Сообщение об ошибке, вызванной последним действием пользователя, если таковая была.</dd>
<dt>found</dt>
<dd>Список карточек, найденных по последнему запросу пользователя из портлета поиска. Эта переменная
предназначена только для использования внутри кода реализации тегов, и не может быть использована
для непосредственного отображения пользователю.</dd>
<dt>today</dt>
<dd>Текущая дата.</dd>
<dt>user</dt>
<dd>Имя пользователя, вошедшего в систему.</dd>

<hr>
<a name="xml"></a>
<h2>Content type=xml</h2>

<p>Отображает поле или материал, содержащее XML, через XSLT-преобразование. В качестве документа XSLT
может использоваться материал из другой карточки либо содержимое внешней Web-страницы. Этот документ
задаётся атрибутом <i>xsl</i> или <i>xslurl</i>, ровно один из которых должен присутствовать в теге.</p>

<h3>Дополнительные атрибуты</h3>
<dt>xsl</dt>
<dd>Идентификатор карточки, содержащей в виде материала документ XSLT, используемый для преобразования.</dd>
<dt>xslurl</dt>
<dd>URL внешнего ресурса, содержащего документ XSLT.</dd>

<!--
<dt>type</dt>
<dd>Тип, способ отображения содержимого. Это ключевой атрибут тега, он определяет набор допустимых в этом теге атрибутов.<br>
Допустимые значения атрибута:
<ul>
<li><b>text</b> &mdash; содержимое материала или поля карточки отображается как простой текст.
<li><b>html</b> &mdash; содержимое материала или поля карточки отображается как HTML.
Производится также обработка тегов &lt;content&gt;.
<li><b>image</b> &mdash; содержимое материала отображается как изображение, включенное в текст.
Атрибут <i>field</i> в этом случае игнорируется.
<li><b>link</b> &mdash; содержимое материала или поля карточки изображается как текст,
оформленный в виде гиперссылки на отображение этой карточки на сайте.
<li><b>file</b> &mdash; содержимое поля карточки отображается в виде гиперссылки на скачивание материала,
прикрепленного к этой карточке.
<li><b>list</b> &mdash; отображает список материалов. Должен содержать ровно один из атрибутов
<i>link</i>, <i>area</i> или <i>xml</i>, определяющий отображаемый список, а также атрибут <i>view</i>,
задающий отображение элементов списка.
<li><b>ident</b> &mdash; содержимое <u>тега</u> отображается несколько раз. Количество повторов
определяется значением поля, указанного в атрибуте <i>field</i>. Поле должно иметь числовой тип.
В навигаторе атрибут <i>field</i> может не указываться, в таком случае используется значение уровня
вложенности элемента, вычисляемое навигатором.
<li><b>var</b> &mdash; отображает содержимое внутренней переменной системы. Имя переменной задаётся
атрибутом <i>var</i>, который является обязательным в данном случае.
<li><b>pages</b> &mdash; отображает навигацию по страницам в списке документов или навигаторе
<i>(последнее пока не реализовано)</i>. Обязательно, с помощью атрибута <i>id</i> или пары
<i>link/item</i>, должна быть задана карточка типа "Навигация страниц".
<li><b>page</b> &mdash; применяется только в карточках типа "Навигация страниц". Отображает ссылку
на страницу списка документов. Текст ссылки задаётся содержимым тега, а если оно пусто, используется
значение атрибута <i>page</i>.
</ul></dd>
-->

<hr>
<p><a href="portlets.html">Портлеты</a>
<a href="templates.html">Шаблоны</a>
Теги
</p>

</body>
</html>